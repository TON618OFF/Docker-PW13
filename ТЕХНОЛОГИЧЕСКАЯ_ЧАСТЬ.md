# 4. ТЕХНОЛОГИЧЕСКАЯ ЧАСТЬ

## 4.1. Используемые языки/СУБД/фреймворки/инструменты

Для реализации проекта «ImperialTunes» были использованы следующие средства разработки:

### Языки программирования и фреймворки:

**Frontend-разработка:**
- **TypeScript 5.8.3** — типизированный надмножество JavaScript, обеспечивающее статическую проверку типов и повышение надёжности кода.
- **React 18.3.1** — библиотека для создания пользовательских интерфейсов на основе компонентного подхода.
- **Vite 5.4.19** — современный инструмент сборки и dev-сервер для веб-приложений с поддержкой горячей перезагрузки модулей (HMR).
- **React Router DOM 6.30.1** — библиотека маршрутизации для одностраничных приложений (SPA).
- **React Hook Form 7.61.1** — библиотека для управления формами с высокой производительностью.
- **Zod 3.25.76** — библиотека схем валидации TypeScript-first, обеспечивающая валидацию данных на клиенте и сервере.

**Стилизация и UI-компоненты:**
- **Tailwind CSS 3.4.17** — utility-first CSS-фреймворк для быстрой разработки пользовательских интерфейсов.
- **Shadcn UI** — коллекция переиспользуемых UI-компонентов на основе Radix UI и Tailwind CSS.
- **Radix UI** — набор низкоуровневых компонентов с поддержкой доступности (a11y).
- **Lucide React 0.462.0** — библиотека иконок для React-приложений.
- **next-themes 0.3.0** — библиотека для управления темами оформления (светлая/тёмная).

**Визуализация данных:**
- **Recharts 2.15.4** — библиотека для построения графиков и диаграмм на основе React и D3.js.

**Утилиты:**
- **date-fns 3.6.0** — библиотека для работы с датами и временем.
- **class-variance-authority 0.7.1** — утилита для управления вариантами стилей компонентов.
- **clsx 2.1.1** — утилита для условного объединения классов CSS.
- **tailwind-merge 2.6.0** — утилита для слияния классов Tailwind CSS без конфликтов.

### СУБД и серверные технологии:

**База данных:**
- **PostgreSQL 15+** — реляционная система управления базами данных с поддержкой транзакций, процедур, триггеров, представлений и развитой системой администрирования. Используется через облачную платформу Supabase.

**Backend-платформа:**
- **Supabase** — открытая платформа Backend-as-a-Service (BaaS), предоставляющая:
  - **Supabase PostgreSQL** — управляемая база данных PostgreSQL с автоматическим масштабированием и резервным копированием.
  - **Supabase Authentication** — сервис аутентификации с поддержкой JWT-токенов, хэширования паролей через bcrypt, управления сессиями и восстановления паролей.
  - **Supabase Storage** — облачное хранилище файлов с поддержкой Row Level Security (RLS) политик для защиты доступа к файлам.
  - **Supabase Realtime** — подписка на изменения базы данных в реальном времени (опционально).
  - **Supabase REST API** — автоматически генерируемый REST API для всех таблиц базы данных.

**Клиентские библиотеки:**
- **@supabase/supabase-js 2.76.1** — официальный клиент для работы с Supabase из JavaScript/TypeScript приложений.
- **@tanstack/react-query 5.83.0** — библиотека для управления состоянием серверных данных, кэширования и синхронизации.

### Инструменты проектирования и администрирования БД:

- **pgAdmin 4** — графический инструмент для управления PostgreSQL, используется для визуализации структуры базы данных, выполнения SQL-запросов и администрирования.
- **Supabase Dashboard** — веб-интерфейс для управления проектами Supabase, включая редактор SQL, управление таблицами, политиками безопасности и Storage.
- **dbdiagram.io / draw.io** — инструменты для построения ER-диаграмм и визуализации структуры базы данных.
- **Supabase CLI** — командная строка для локальной разработки, миграций базы данных и управления проектами Supabase.

### Инструменты для обеспечения безопасности и тестирования:

**Безопасность:**
- **Supabase Auth (bcrypt)** — автоматическое хэширование паролей с использованием алгоритма bcrypt и соли (salt).
- **Row Level Security (RLS)** — встроенная система безопасности PostgreSQL для контроля доступа на уровне строк через политики безопасности.
- **JWT (JSON Web Tokens)** — токены для управления сессиями пользователей и аутентификации API-запросов.

**Тестирование:**
- **Postman** — инструмент для тестирования REST API, проверки эндпоинтов Supabase и отладки HTTP-запросов.
- **React DevTools** — расширение для браузера для отладки React-компонентов и состояния приложения.
- **Supabase Logs** — встроенная система логирования для мониторинга запросов к базе данных и ошибок.

### Средства разработки и контроля версий:

**IDE и редакторы:**
- **Visual Studio Code** — интегрированная среда разработки с поддержкой TypeScript, React, расширений для работы с Git, Supabase и отладки.
- **Расширения VS Code:**
  - ESLint — линтер для JavaScript/TypeScript.
  - Prettier — форматировщик кода.
  - Tailwind CSS IntelliSense — автодополнение для Tailwind CSS.
  - Supabase — расширение для работы с Supabase проектами.

**Контроль версий:**
- **Git 2.x** — распределённая система контроля версий для отслеживания изменений в исходном коде.
- **GitHub** — платформа для размещения исходного кода, управления репозиториями и совместной разработки.

**Линтинг и форматирование:**
- **ESLint 9.32.0** — инструмент для статического анализа кода и выявления ошибок.
- **TypeScript ESLint 8.38.0** — плагины ESLint для TypeScript с поддержкой правил для React.
- **PostCSS 8.5.6** — инструмент для трансформации CSS с поддержкой плагинов (autoprefixer).

### Контейнеризация и развёртывание:

- **Docker 24.x** — платформа для контейнеризации приложений, обеспечивающая изоляцию и портативность.
- **Docker Compose 2.x** — инструмент для определения и запуска многоконтейнерных Docker-приложений.
- **Nginx Alpine** — лёгкий веб-сервер и reverse proxy для развёртывания статических файлов и балансировки нагрузки.
- **Node.js 18+** — среда выполнения JavaScript для запуска инструментов сборки и скриптов бэкапа.

### Средства визуализации и отчётности:

- **Recharts** — библиотека для построения графиков и диаграмм (столбчатые, линейные, круговые диаграммы).
- **Excel / CSV** — форматы для экспорта данных аналитики и отчётов через веб-интерфейс.
- **JSON** — формат для экспорта данных и API-ответов.

### Дополнительные инструменты:

- **html2canvas 1.4.1** — библиотека для создания скриншотов элементов веб-страницы.
- **jspdf 3.0.3** — библиотека для генерации PDF-документов из данных приложения.
- **sonner 1.7.4** — библиотека для отображения уведомлений (toasts) в пользовательском интерфейсе.

---

## 4.2. Процесс разработки и отладки

### 4.2.1. Методология разработки

Проект «ImperialTunes» разрабатывался с использованием итеративного подхода и компонентной архитектуры. Процесс разработки включает следующие этапы:

**1. Планирование и проектирование:**
- Определение требований и функциональных спецификаций.
- Проектирование структуры базы данных (ER-диаграммы, нормализация до 3NF).
- Проектирование архитектуры приложения (компонентная структура, маршрутизация, состояние).
- Создание миграций базы данных для версионирования схемы.

**2. Разработка базы данных:**
- Создание таблиц, связей и ограничений целостности через SQL-миграции.
- Реализация хранимых процедур, функций и триггеров для бизнес-логики.
- Настройка Row Level Security (RLS) политик для контроля доступа.
- Создание представлений (views) для упрощения запросов и аналитики.
- Настройка Storage buckets и политик доступа для файлов.

**3. Разработка клиентского приложения:**
- Создание компонентов пользовательского интерфейса на основе React и TypeScript.
- Реализация маршрутизации и защищённых маршрутов (ProtectedRoute).
- Интеграция с Supabase API для работы с данными и файлами.
- Реализация управления состоянием (React Context API, React Query).
- Стилизация компонентов с использованием Tailwind CSS и Shadcn UI.

**4. Интеграция и тестирование:**
- Интеграционное тестирование с Supabase API.
- Функциональное тестирование пользовательских сценариев.
- Тестирование безопасности (проверка RLS политик, валидация данных).
- Тестирование производительности и оптимизация запросов.

**5. Развёртывание:**
- Сборка production-версии приложения через Vite.
- Контейнеризация приложения с использованием Docker.
- Настройка Nginx для развёртывания статических файлов.
- Развёртывание на облачной платформе или локальном сервере.

### 4.2.2. Процесс отладки

**Инструменты отладки:**

**1. Отладка клиентского приложения:**
- **React DevTools** — инструмент для инспекции компонентов React, состояния (state), пропсов (props) и производительности компонентов.
- **Browser DevTools** — встроенные инструменты разработчика браузера для отладки JavaScript, сетевых запросов, производительности и манипуляций с DOM.
- **Vite HMR (Hot Module Replacement)** — автоматическая перезагрузка модулей при изменении кода без полной перезагрузки страницы, ускоряющая процесс разработки.
- **TypeScript Compiler** — статическая проверка типов на этапе компиляции для выявления ошибок до выполнения кода.
- **ESLint** — статический анализ кода для выявления потенциальных ошибок, нарушений стиля кода и best practices.

**2. Отладка базы данных:**
- **Supabase Dashboard — SQL Editor** — веб-интерфейс для выполнения SQL-запросов, проверки структуры таблиц, просмотра данных и отладки функций и триггеров.
- **Supabase Logs** — система логирования для мониторинга запросов к базе данных, ошибок SQL, производительности запросов и активности пользователей.
- **pgAdmin** — графический инструмент для выполнения сложных SQL-запросов, анализа планов выполнения запросов и администрирования базы данных.
- **Postman** — тестирование REST API эндпоинтов Supabase, проверка корректности ответов и отладка HTTP-запросов.

**3. Отладка безопасности:**
- **Supabase RLS Policy Tester** — проверка политик Row Level Security через выполнение тестовых запросов с различными ролями пользователей.
- **Browser Network Tab** — мониторинг HTTP-запросов к Supabase API, проверка заголовков авторизации, токенов JWT и ответов сервера.
- **Supabase Auth Debugging** — проверка процесса аутентификации, управления сессиями и валидации токенов через логи Supabase.

**Методы отладки:**

**1. Логирование:**
- Использование `console.log()`, `console.error()`, `console.warn()` для вывода отладочной информации в консоль браузера.
- Использование Supabase Logs для мониторинга запросов к базе данных и ошибок на сервере.
- Логирование ошибок через систему аудита (таблица `audit_log`) для отслеживания критических операций.

**2. Обработка ошибок:**
- Использование try-catch блоков для перехвата и обработки ошибок в асинхронных операциях.
- Отображение пользовательских сообщений об ошибках через компоненты уведомлений (Toast).
- Валидация входных данных на клиенте (Zod) и сервере (CHECK ограничения, триггеры) для предотвращения некорректных данных.

**3. Тестирование:**
- Ручное тестирование функциональности через пользовательский интерфейс.
- Тестирование API через Postman с различными сценариями и данными.
- Проверка корректности работы RLS политик через выполнение запросов с различными ролями пользователей.

**4. Профилирование:**
- Использование React DevTools Profiler для анализа производительности компонентов React.
- Использование Browser Performance Tab для анализа времени загрузки страниц и производительности JavaScript.
- Анализ планов выполнения SQL-запросов через EXPLAIN для оптимизации запросов к базе данных.

### 4.2.3. Управление версиями и миграциями

**Контроль версий кода:**
- Использование Git для отслеживания изменений в исходном коде.
- Создание веток (branches) для разработки новых функций и исправления ошибок.
- Слияние изменений через Pull Requests на GitHub с проверкой кода.

**Миграции базы данных:**
- Хранение SQL-миграций в директории `supabase/migrations/` с версионированием по дате и времени.
- Применение миграций через Supabase CLI или Supabase Dashboard.
- Откат миграций при необходимости через создание новых миграций для отмены изменений.

**Резервное копирование:**
- Автоматическое создание бэкапов базы данных через скрипты Node.js (`scripts/backup-supabase.js`).
- Резервное копирование Storage файлов (аудиофайлы, изображения) в локальное хранилище.
- Восстановление данных из бэкапов через скрипты восстановления (`scripts/restore-supabase.js`).

---

## 4.3. Защитное программирование

### 4.3.1. Валидация входных данных

**Клиентская валидация:**
- Валидация данных через JavaScript-проверки перед отправкой на сервер.
- Проверка форматов данных (email через HTML5 атрибут `type="email"`, форматы файлов через расширения).
- Проверка длин строк, размеров файлов и диапазонов значений.
- Отображение пользовательских сообщений об ошибках валидации через toast-уведомления в реальном времени.
- Валидация уникальности данных (например, проверка уникальности username) через запросы к базе данных.

**Пример валидации:**
```typescript
// Валидация username при регистрации (src/pages/Auth.tsx, строки 62-79)
// Проверка длины username
if (!username.trim() || username.length < 3 || username.length > 50) {
  toast.error(t('auth.usernameLength'));
  setLoading(false);
  return;
}

// Проверка уникальности username через запрос к базе данных
const { data: existingUser } = await supabase
  .from("users")
  .select("username")
  .eq("username", username.trim())
  .single();

if (existingUser) {
  toast.error(t('auth.usernameTaken'));
  setLoading(false);
  return;
}

// Валидация формата и размера файла при загрузке трека (src/components/UploadTrackDialog.tsx, строки 217-229)
const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (file) {
    // Проверяем формат файла
    const extension = file.name.split('.').pop()?.toLowerCase();
    if (!audioFormats.some(format => format.value === extension)) {
      toast.error(t('upload.error.fileFormat'));
      return;
    }

    // Проверяем размер файла (50MB)
    if (file.size > 50 * 1024 * 1024) {
      toast.error(t('upload.error.fileSize'));
      return;
    }
    // ... остальная логика
  }
};
```

**Серверная валидация:**
- Использование **CHECK ограничений** в PostgreSQL для валидации данных на уровне базы данных.
- Валидация через **триггеры** перед вставкой или обновлением данных.
- Проверка форматов файлов и размеров через политики Supabase Storage.

**Пример CHECK ограничения:**
```sql
-- Проверка длительности трека и других ограничений (supabase/migrations/20250201000000_complete_database_schema.sql, строки 239-249)
CREATE TABLE public.tracks (
    -- ... другие поля ...
    track_duration INTEGER NOT NULL,
    track_play_count INTEGER NOT NULL DEFAULT 0,
    track_like_count INTEGER NOT NULL DEFAULT 0,
    track_order INTEGER NOT NULL DEFAULT 1,
    track_title TEXT NOT NULL,
    -- ... другие поля ...
    CHECK (
        track_duration > 0
        AND track_duration <= 7200
    ),
    CHECK (track_play_count >= 0),
    CHECK (track_like_count >= 0),
    CHECK (track_order > 0),
    CHECK (
        LENGTH(track_title) >= 1
        AND LENGTH(track_title) <= 100
    )
);
```

### 4.3.2. Защита от SQL-инъекций

- Использование **параметризованных запросов** через Supabase Client API вместо конкатенации строк.
- Все SQL-запросы выполняются через Supabase Client, который автоматически экранирует параметры.
- Использование **хранимых процедур и функций** для выполнения сложных операций на сервере.

**Пример безопасного запроса:**
```typescript
// Безопасный параметризованный запрос через Supabase Client API (src/pages/Library.tsx, строки 99-128)
const fetchTracks = async () => {
  try {
    const { data, error } = await supabase
      .from("tracks")
      .select(`
        id,
        track_title,
        track_duration,
        track_play_count,
        track_like_count,
        track_audio_url,
        uploaded_by,
        created_at,
        album:albums(
          id,
          album_title,
          album_cover_url,
          artist:artists(
            id,
            artist_name
          )
        ),
        genres:track_genres(
          id,
          genre:genres(
            id,
            genre_name
          )
        )
      `)
      .eq("is_public", true)  // Параметры автоматически экранируются
      .order(sortBy, { ascending: sortOrder === "asc" });

    if (error) throw error;
    // ... обработка данных
  } catch (error: any) {
    toast.error(t('library.errorLoad'));
  }
};

// НЕ безопасно: конкатенация строк (не используется в проекте)
// const query = `SELECT * FROM tracks WHERE id = '${trackId}';`
```

### 4.3.3. Защита от XSS (Cross-Site Scripting)

- **Автоматическое экранирование** React при рендеринге данных пользователя.
- Использование **React.createElement** вместо `dangerouslySetInnerHTML` для рендеринга HTML-контента.
- Валидация и санитизация пользовательского ввода перед отображением.
- Использование **Content Security Policy (CSP)** заголовков в Nginx для ограничения источников скриптов.

**Пример безопасного рендеринга:**
```typescript
// Безопасный рендеринг данных пользователя в профиле (src/pages/Profile.tsx)
// React автоматически экранирует все данные при рендеринге в JSX
<div className="space-y-2">
  <h2 className="text-2xl font-bold">{profile.username}</h2>
  <p className="text-muted-foreground">{profile.email}</p>
  {profile.bio && (
    <p className="text-sm">{profile.bio}</p>
  )}
</div>

// Безопасный рендеринг данных трека в библиотеке (src/pages/Library.tsx, строки 288-299)
<div className="flex-1 min-w-0">
  <h3 className="font-semibold truncate">{track.track_title}</h3>
  <p className="text-sm text-muted-foreground truncate">
    {track.album?.artist?.artist_name}
  </p>
</div>

// НЕ безопасно: прямой HTML через dangerouslySetInnerHTML (не используется для пользовательских данных)
// <div dangerouslySetInnerHTML={{ __html: userInput }} />
// Примечание: dangerouslySetInnerHTML используется только для безопасного SVG-контента в компонентах графиков
```

### 4.3.4. Защита от CSRF (Cross-Site Request Forgery)

- Использование **JWT-токенов** для аутентификации API-запросов вместо cookies.
- Хранение токенов в **localStorage** или **sessionStorage** браузера.
- Использование **SameSite cookies** в Supabase Auth для защиты от CSRF-атак.
- Проверка заголовка **Origin** на сервере для валидации источников запросов.

### 4.3.5. Обработка ошибок

- Использование **try-catch блоков** для перехвата и обработки ошибок в асинхронных операциях.
- Логирование ошибок через систему аудита (таблица `audit_log`) для отслеживания критических операций.
- Отображение пользовательских сообщений об ошибках без раскрытия технических деталей.
- Валидация ответов от API перед использованием данных в приложении.

**Пример обработки ошибок:**
```typescript
// Обработка ошибок при загрузке треков (src/pages/Library.tsx, строки 97-145)
const fetchTracks = async () => {
  try {
    const { data, error } = await supabase
      .from("tracks")
      .select(`
        id,
        track_title,
        track_duration,
        track_play_count,
        track_like_count,
        track_audio_url,
        uploaded_by,
        created_at,
        album:albums(
          id,
          album_title,
          album_cover_url,
          artist:artists(
            id,
            artist_name
          )
        ),
        genres:track_genres(
          id,
          genre:genres(
            id,
            genre_name
          )
        )
      `)
      .eq("is_public", true)
      .order(sortBy, { ascending: sortOrder === "asc" });

    if (error) throw error;
    
    // Преобразуем данные для удобства использования
    const transformedTracks = (data || []).map(track => ({
      ...track,
      genres: track.genres.map(tg => tg.genre)
    }));
    
    setTracks(transformedTracks);
    setPlaylist(transformedTracks);
  } catch (error: any) {
    console.error('Ошибка при загрузке треков:', error);
    toast.error(t('library.errorLoad'));
  } finally {
    setLoading(false);
  }
};

// Обработка ошибок при авторизации (src/pages/Auth.tsx, строки 27-133)
const handleAuth = async (e: React.FormEvent) => {
  e.preventDefault();
  setLoading(true);

  try {
    if (isLogin) {
      const { data: signInData, error: signInError } = await supabase.auth.signInWithPassword({
        email,
        password,
      });
      
      if (signInError) throw signInError;
      // ... обработка успешной авторизации
    } else {
      // ... логика регистрации
    }
  } catch (error: any) {
    toast.error(error.message || t('auth.error'));
  } finally {
    setLoading(false);
  }
};
```

### 4.3.6. Защита маршрутов

- Использование компонента **ProtectedRoute** для защиты маршрутов, требующих аутентификации.
- Проверка роли пользователя перед доступом к административным функциям.
- Редирект неавторизованных пользователей на страницу авторизации.

**Пример защиты маршрута:**
```typescript
// Защита административных маршрутов (src/App.tsx, строки 52-67)
<Route 
  path="/admin" 
  element={
    <ProtectedRoute requireAdmin>
      <AdminPanel />
    </ProtectedRoute>
  } 
/>
<Route 
  path="/applications" 
  element={
    <ProtectedRoute requireContentManagement>
      <ArtistApplicationsManager />
    </ProtectedRoute>
  } 
/>

// Реализация компонента ProtectedRoute (src/components/ProtectedRoute.tsx, строки 12-45)
const ProtectedRoute = ({ 
  children, 
  requiredRole, 
  requireAdmin = false, 
  requireContentManagement = false 
}: ProtectedRouteProps) => {
  const { role, loading, isAdmin, canManageContent } = useRole();

  if (loading) {
    return (
      <div className="flex items-center justify-center py-12">
        <div className="animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"></div>
      </div>
    );
  }

  if (!role) {
    return <Navigate to="/auth" replace />;
  }

  if (requireAdmin && !isAdmin) {
    return <Navigate to="/" replace />;
  }

  if (requireContentManagement && !canManageContent) {
    return <Navigate to="/" replace />;
  }

  if (requiredRole && role !== requiredRole) {
    return <Navigate to="/" replace />;
  }

  return <>{children}</>;
};
```

### 4.3.7. Защита файлов

- Валидация форматов файлов (MIME-типы) перед загрузкой в Supabase Storage.
- Ограничение размеров файлов через политики Storage buckets.
- Использование **Row Level Security (RLS)** политик для контроля доступа к файлам в Storage.
- Проверка прав доступа перед загрузкой, обновлением или удалением файлов.

### 4.3.8. Аудит и мониторинг

- Логирование всех критических операций (создание, обновление, удаление) через триггер `audit_changes`.
- Хранение истории изменений в таблице `audit_log` с информацией о пользователе, типе операции, старых и новых значениях.
- Мониторинг запросов к базе данных через Supabase Logs для выявления подозрительной активности.

---

## 4.4. DevOps-схема

### 4.4.1. Контроль версий (Git/GitHub)

**Структура репозитория:**
- **Основная ветка (main/master)** — стабильная версия приложения, готовая к развёртыванию.
- **Ветки разработки (develop/feature)** — ветки для разработки новых функций и исправления ошибок.
- **Ветки функций (feature/)** — изолированные ветки для разработки отдельных функций.

**Процесс работы с Git:**
1. Создание ветки для новой функции: `git checkout -b feature/new-feature`
2. Коммит изменений: `git commit -m "Описание изменений"`
3. Отправка изменений в репозиторий: `git push origin feature/new-feature`
4. Создание Pull Request на GitHub для проверки и слияния изменений.
5. Слияние изменений в основную ветку после проверки и тестирования.

**Файлы конфигурации:**
- `.gitignore` — список файлов и директорий, исключаемых из контроля версий (node_modules, .env, build, dist).
- `README.md` — документация проекта с описанием установки, настройки и использования.

### 4.4.2. Контейнеризация (Docker)

**Dockerfile:**
- **Multi-stage build** для оптимизации размера образа Docker.
- Этап `deps` — установка зависимостей для production.
- Этап `builder` — сборка приложения через Vite.
- Этап `runner` — финальный образ на основе Nginx Alpine с собранным приложением.
- Запуск приложения от **непривилегированного пользователя** для безопасности.

**Docker Compose:**
- Сервис `app` — основное приложение (React-приложение, собранное через Vite и развёрнутое через Nginx).
- Сервис `db` — база данных PostgreSQL 15 для локальной разработки (опционально).
- Сервис `redis` — кэширование данных (опционально).
- Сервис `nginx` — reverse proxy и балансировка нагрузки.
- Сеть `imperial-tunes-network` — изолированная сеть Docker для связи между сервисами.

**Команды Docker:**
```bash
# Сборка образа
docker build -t imperial-tunes .

# Запуск через Docker Compose
docker-compose up -d

# Остановка контейнеров
docker-compose down

# Просмотр логов
docker-compose logs -f app
```

### 4.4.3. Развёртывание (Deployment)

**Процесс развёртывания:**
1. **Сборка приложения:**
   - Выполнение команды `npm run build` для создания production-версии приложения.
   - Оптимизация и минификация JavaScript, CSS и других ресурсов через Vite.
   - Генерация статических файлов в директории `dist/`.

2. **Контейнеризация:**
   - Сборка Docker-образа с использованием Dockerfile.
   - Тестирование образа в локальной среде.
   - Публикация образа в Docker Registry (опционально).

3. **Развёртывание на сервере:**
   - Развёртывание Docker-контейнеров на сервере через Docker Compose.
   - Настройка Nginx для проксирования запросов и развёртывания статических файлов.
   - Настройка SSL-сертификатов для HTTPS (опционально).

4. **Настройка переменных окружения:**
   - Создание файла `.env` с настройками подключения к Supabase (URL, API keys).
   - Настройка переменных окружения в Docker Compose или на сервере.

**Конфигурация Nginx:**
- Проксирование запросов к Supabase API.
- Развёртывание статических файлов React-приложения.
- Настройка заголовков безопасности (CSP, HSTS, X-Frame-Options).
- Настройка кэширования статических ресурсов.

### 4.4.4. CI/CD (Continuous Integration/Continuous Deployment)

**Автоматизация (опционально):**
- Настройка GitHub Actions для автоматической сборки и развёртывания приложения.
- Автоматическое выполнение тестов при создании Pull Request.
- Автоматическое развёртывание на staging-сервер после слияния в основную ветку.
- Автоматическое развёртывание на production-сервер после создания тега (release).

**Этапы CI/CD:**
1. **Lint** — проверка кода через ESLint.
2. **Build** — сборка приложения через Vite.
3. **Test** — выполнение тестов (если реализованы).
4. **Deploy** — развёртывание на сервер через Docker или другие средства.

### 4.4.5. Мониторинг и логирование

**Мониторинг приложения:**
- Использование Supabase Logs для мониторинга запросов к базе данных.
- Логирование ошибок через систему аудита (таблица `audit_log`).
- Мониторинг производительности через Browser DevTools и React DevTools.

**Логирование:**
- Логи приложения через `console.log()`, `console.error()` в development-режиме.
- Логи Nginx для мониторинга HTTP-запросов и ошибок.
- Логи Docker-контейнеров через `docker-compose logs`.

### 4.4.6. Резервное копирование и восстановление

**Автоматическое резервное копирование:**
- Скрипты Node.js для создания бэкапов базы данных и Storage файлов (`scripts/backup-supabase.js`).
- Планирование автоматических бэкапов через cron-задачи или планировщик задач Windows.
- Хранение бэкапов в локальном хранилище или облачном хранилище (опционально).

**Восстановление:**
- Скрипты восстановления данных из бэкапов (`scripts/restore-supabase.js`).
- Восстановление базы данных через SQL-скрипты.
- Восстановление Storage файлов через Supabase Storage API.

---

## 4.5. Характеристики системы

### 4.5.1. Функциональные характеристики

**Основные функции:**
- Просмотр каталога музыкальных треков, альбомов и артистов.
- Воспроизведение музыки через встроенный музыкальный плеер.
- Создание и управление плейлистами (публичные и приватные).
- Добавление треков, альбомов и плейлистов в избранное.
- Загрузка собственного контента для артистов (треки, альбомы).
- Управление пользователями и контентом для администраторов и модераторов.
- Просмотр статистики и аналитики (графики прослушиваний, популярные треки, статистика по жанрам).

**Роли пользователей:**
- **Слушатель** — базовый пользователь, может прослушивать музыку, создавать плейлисты, добавлять треки в избранное.
- **Артист** — может загружать треки и альбомы, управлять своим контентом, просматривать статистику.
- **Дистрибьютор** — может обрабатывать заявки на статус артиста, управлять контентом.
- **Модератор** — может модерировать контент, обрабатывать заявки.
- **Администратор** — имеет полный доступ к управлению системой, пользователями и контентом.

### 4.5.2. Технические характеристики

**Производительность:**
- Время загрузки страницы: менее 3 секунд при скорости интернета 5 Мбит/с.
- Время отклика API: менее 500 мс для стандартных запросов.
- Поддержка одновременных пользователей: до 1000 пользователей (ограничения Supabase Free Tier).
- Оптимизация запросов к базе данных через индексы и представления.

**Масштабируемость:**
- Горизонтальное масштабирование через Docker-контейнеры и Nginx load balancing.
- Вертикальное масштабирование базы данных через Supabase (автоматическое масштабирование).
- Кэширование данных через React Query для уменьшения нагрузки на базу данных.

**Надёжность:**
- Автоматическое резервное копирование базы данных через Supabase.
- Транзакции для обеспечения целостности данных при сложных операциях.
- Обработка ошибок и отображение пользовательских сообщений об ошибках.

**Безопасность:**
- Аутентификация через Supabase Auth с хэшированием паролей (bcrypt).
- Авторизация через Row Level Security (RLS) политики и ролевую модель (RBAC).
- Защита от SQL-инъекций через параметризованные запросы.
- Защита от XSS через автоматическое экранирование React.
- Защита от CSRF через JWT-токены и SameSite cookies.
- Аудит изменений через триггеры и таблицу `audit_log`.

### 4.5.3. Требования к системе

**Минимальные требования:**
- Процессор: с частотой не менее 1 ГГц.
- Оперативная память: не менее 2 ГБ.
- Интернет-соединение: стабильное подключение к интернету (скорость не менее 1 Мбит/с).
- Веб-браузер: Google Chrome 90+, Mozilla Firefox 88+, Microsoft Edge 90+, Safari 14+, Opera 76+.

**Рекомендуемые требования:**
- Процессор: с частотой не менее 2 ГГц (многоядерный).
- Оперативная память: не менее 4 ГБ.
- Интернет-соединение: стабильное подключение к интернету (скорость не менее 5 Мбит/с для комфортного прослушивания музыки).
- Веб-браузер: последняя версия Google Chrome, Mozilla Firefox или Microsoft Edge.

### 4.5.4. Ограничения системы

**Ограничения Supabase Free Tier:**
- Размер базы данных: до 500 МБ.
- Размер Storage: до 1 ГБ.
- Количество API-запросов: до 50 000 запросов в месяц.
- Количество одновременных пользователей: до 1000 пользователей.

**Ограничения приложения:**
- Максимальный размер аудиофайла: 50 МБ (настраивается через политики Storage).
- Поддерживаемые форматы аудио: MP3, WAV, FLAC, OGG, M4A.
- Поддерживаемые форматы изображений: JPG, PNG, WebP.
- Максимальная длина названия трека: 255 символов.
- Максимальная длина описания: 1000 символов.

### 4.5.5. Совместимость

**Браузеры:**
- Google Chrome 90+ (полная поддержка).
- Mozilla Firefox 88+ (полная поддержка).
- Microsoft Edge 90+ (полная поддержка).
- Safari 14+ (полная поддержка).
- Opera 76+ (полная поддержка).

**Операционные системы:**
- Windows 10/11.
- macOS 10.14+.
- Linux (любая современная дистрибуция).
- Android 8.0+ (через мобильные браузеры).
- iOS 12.0+ (через мобильные браузеры).

**Устройства:**
- Десктопные компьютеры (Windows, macOS, Linux).
- Планшеты (Android, iOS).
- Смартфоны (Android, iOS).

---

## 5. СПИСОК ИСТОЧНИКОВ

1. React — Официальная документация [Электронный ресурс]. — Режим доступа: https://react.dev/ (дата обращения: 15.01.2025).

2. TypeScript — Официальная документация [Электронный ресурс]. — Режим доступа: https://www.typescriptlang.org/docs/ (дата обращения: 15.01.2025).

3. Vite — Официальная документация [Электронный ресурс]. — Режим доступа: https://vitejs.dev/ (дата обращения: 15.01.2025).

4. PostgreSQL — Официальная документация [Электронный ресурс]. — Режим доступа: https://www.postgresql.org/docs/ (дата обращения: 15.01.2025).

5. Supabase — Официальная документация [Электронный ресурс]. — Режим доступа: https://supabase.com/docs (дата обращения: 15.01.2025).

6. Tailwind CSS — Официальная документация [Электронный ресурс]. — Режим доступа: https://tailwindcss.com/docs (дата обращения: 15.01.2025).

7. React Router — Официальная документация [Электронный ресурс]. — Режим доступа: https://reactrouter.com/en/main (дата обращения: 15.01.2025).

8. React Hook Form — Официальная документация [Электронный ресурс]. — Режим доступа: https://react-hook-form.com/ (дата обращения: 15.01.2025).

9. Zod — Официальная документация [Электронный ресурс]. — Режим доступа: https://zod.dev/ (дата обращения: 15.01.2025).

10. Recharts — Официальная документация [Электронный ресурс]. — Режим доступа: https://recharts.org/ (дата обращения: 15.01.2025).

11. Docker — Официальная документация [Электронный ресурс]. — Режим доступа: https://docs.docker.com/ (дата обращения: 15.01.2025).

12. Nginx — Официальная документация [Электронный ресурс]. — Режим доступа: https://nginx.org/en/docs/ (дата обращения: 15.01.2025).

13. Git — Официальная документация [Электронный ресурс]. — Режим доступа: https://git-scm.com/doc (дата обращения: 15.01.2025).

14. GitHub — Официальная документация [Электронный ресурс]. — Режим доступа: https://docs.github.com/ (дата обращения: 15.01.2025).

15. ESLint — Официальная документация [Электронный ресурс]. — Режим доступа: https://eslint.org/docs/latest/ (дата обращения: 15.01.2025).

16. Node.js — Официальная документация [Электронный ресурс]. — Режим доступа: https://nodejs.org/docs/ (дата обращения: 15.01.2025).

17. Shadcn UI — Официальная документация [Электронный ресурс]. — Режим доступа: https://ui.shadcn.com/ (дата обращения: 15.01.2025).

18. Radix UI — Официальная документация [Электронный ресурс]. — Режим доступа: https://www.radix-ui.com/ (дата обращения: 15.01.2025).

19. React Query (TanStack Query) — Официальная документация [Электронный ресурс]. — Режим доступа: https://tanstack.com/query/latest (дата обращения: 15.01.2025).

20. ГОСТ Р 56938-2016. Защита информации. Защита информации в автоматизированных системах управления производством. Общие положения [Текст]. — М.: Стандартинформ, 2016. — 12 с.

21. ГОСТ Р 57580.1-2017. Защита информации. Обеспечение безопасности на этапах жизненного цикла систем защиты информации. Часть 1. Общие положения [Текст]. — М.: Стандартинформ, 2017. — 20 с.

22. ГОСТ Р ИСО/МЭК 27001-2021. Информационная безопасность, cybersecurity и защита приватности. Системы менеджмента информационной безопасности. Требования [Текст]. — М.: Стандартинформ, 2021. — 32 с.

23. ГОСТ 34.602-2020. Информационные технологии. Комплекс стандартов на автоматизированные системы. Техническое задание на создание автоматизированной системы [Текст]. — М.: Стандартинформ, 2020. — 28 с.

24. ГОСТ 19.701-90. Единая система программной документации. Схемы алгоритмов, программ, данных и систем. Обозначения условные и правила выполнения [Текст]. — М.: Стандартинформ, 1990. — 26 с.

25. ГОСТ 19.505-79. Единая система программной документации. Руководство оператора. Требования к содержанию и оформлению [Текст]. — М.: Стандартинформ, 1979. — 8 с.

26. ГОСТ 19.502-78. Единая система программной документации. Описание применения. Требования к содержанию и оформлению [Текст]. — М.: Стандартинформ, 1978. — 6 с.

27. ГОСТ 19.503-79. Единая система программной документации. Руководство системного программиста. Требования к содержанию и оформлению [Текст]. — М.: Стандартинформ, 1979. — 8 с.

28. ГОСТ 19.504-79. Единая система программной документации. Руководство программиста. Требования к содержанию и оформлению [Текст]. — М.: Стандартинформ, 1979. — 8 с.

29. ГОСТ 19.506-79. Единая система программной документации. Описание языка. Требования к содержанию и оформлению [Текст]. — М.: Стандартинформ, 1979. — 6 с.

30. ГОСТ 19.601-78. Единая система программной документации. Правила дублирования, учёта и хранения [Текст]. — М.: Стандартинформ, 1978. — 12 с.

31. ГОСТ 34.201-89. Виды, комплектность и обозначение документов при создании автоматизированных систем [Текст]. — М.: Стандартинформ, 1989. — 14 с.

32. ГОСТ 34.003-90. Информационные технологии. Комплекс стандартов на автоматизированные системы. Автоматизированные системы. Термины и определения [Текст]. — М.: Стандартинформ, 1990. — 22 с.

33. ГОСТ 34.601-90. Информационные технологии. Комплекс стандартов на автоматизированные системы. Стадии создания автоматизированных систем [Текст]. — М.: Стандартинформ, 1990. — 10 с.

34. ГОСТ 34.603-92. Информационные технологии. Виды испытаний автоматизированных систем [Текст]. — М.: Стандартинформ, 1992. — 8 с.

35. PostgreSQL: Row Level Security — Официальная документация [Электронный ресурс]. — Режим доступа: https://www.postgresql.org/docs/current/ddl-rowsecurity.html (дата обращения: 15.01.2025).

36. OWASP Top 10 — Официальный сайт [Электронный ресурс]. — Режим доступа: https://owasp.org/www-project-top-ten/ (дата обращения: 15.01.2025).

37. Web Content Accessibility Guidelines (WCAG) 2.1 — Официальная документация [Электронный ресурс]. — Режим доступа: https://www.w3.org/WAI/WCAG21/quickref/ (дата обращения: 15.01.2025).

38. MDN Web Docs — Официальная документация по веб-технологиям [Электронный ресурс]. — Режим доступа: https://developer.mozilla.org/ (дата обращения: 15.01.2025).

39. JSON Web Token (JWT) — Официальная спецификация [Электронный ресурс]. — Режим доступа: https://jwt.io/ (дата обращения: 15.01.2025).

40. REST API — Официальная документация [Электронный ресурс]. — Режим доступа: https://restfulapi.net/ (дата обращения: 15.01.2025).

---