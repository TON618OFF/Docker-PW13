-- =================================================================================================
-- СКРИПТ ДЛЯ ОЧИСТКИ ВСЕХ ТАБЛИЦ БАЗЫ ДАННЫХ
-- =================================================================================================
-- Этот скрипт удаляет все данные из всех таблиц, сохраняя структуру базы данных
-- ВНИМАНИЕ: Все данные будут безвозвратно удалены!
-- =================================================================================================

-- Отключаем проверку внешних ключей для упрощения процесса
SET session_replication_role = 'replica';

-- =================================================================================================
-- ОЧИСТКА ТАБЛИЦ В ЗАВИСИМОСТИ ОТ ПОРЯДКА (сначала дочерние, затем родительские)
-- =================================================================================================

-- Очистка таблиц связей и зависимых данных
TRUNCATE TABLE public.favorites_tracks CASCADE;
TRUNCATE TABLE public.favorites_albums CASCADE;
TRUNCATE TABLE public.favorites_playlists CASCADE;
TRUNCATE TABLE public.playlist_tracks CASCADE;
TRUNCATE TABLE public.track_genres CASCADE;
TRUNCATE TABLE public.listening_history CASCADE;
TRUNCATE TABLE public.audit_log CASCADE;

-- Очистка таблицы анкет артистов
TRUNCATE TABLE public.artist_applications CASCADE;

-- Очистка основных таблиц контента
TRUNCATE TABLE public.tracks CASCADE;
TRUNCATE TABLE public.playlists CASCADE;
TRUNCATE TABLE public.albums CASCADE;
TRUNCATE TABLE public.artists CASCADE;

-- Очистка таблиц пользователей и ролей (осторожно!)
-- TRUNCATE TABLE public.users CASCADE; -- Раскомментируйте, если нужно очистить и пользователей
-- TRUNCATE TABLE public.roles CASCADE; -- Раскомментируйте, если нужно очистить и роли

-- Очистка таблицы жанров
TRUNCATE TABLE public.genres CASCADE;

-- =================================================================================================
-- ВОССТАНОВЛЕНИЕ БАЗОВЫХ ДАННЫХ (роли и жанры)
-- =================================================================================================

-- Восстанавливаем роли
INSERT INTO public.roles (role_name, role_description)
VALUES 
    ('слушатель', 'Обычный пользователь, может слушать музыку и создавать плейлисты'),
    ('администратор', 'Полный доступ ко всем функциям системы'),
    ('артист', 'Может загружать и управлять своими треками и альбомами'),
    ('дистрибьютор', 'Может загружать музыку от имени артистов'),
    ('модератор', 'Может модерировать контент и пользователей')
ON CONFLICT (role_name) DO NOTHING;

-- Восстанавливаем жанры
INSERT INTO public.genres (genre_name, genre_description)
VALUES 
    ('Поп', 'Популярная музыка'),
    ('Рок', 'Рок-музыка во всех её проявлениях'),
    ('Хип-Хоп', 'Хип-хоп и рэп музыка'),
    ('Электронная', 'Электронная музыка'),
    ('Джаз', 'Джазовая музыка'),
    ('Классическая', 'Классическая музыка')
ON CONFLICT (genre_name) DO NOTHING;

-- Восстанавливаем стандартную роль для session_replication_role
SET session_replication_role = 'origin';

-- =================================================================================================
-- КОНЕЦ СКРИПТА
-- =================================================================================================
-- ВСЕ ДАННЫЕ УДАЛЕНЫ, СТРУКТУРА БАЗЫ ДАННЫХ СОХРАНЕНА
-- =================================================================================================

