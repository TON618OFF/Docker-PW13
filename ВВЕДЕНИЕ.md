# ВВЕДЕНИЕ

## 1.1. Цель разработки

Целью разработки является создание полнофункционального музыкального онлайн-портала «ImperialTunes», обеспечивающего централизованное хранение, управление и воспроизведение музыкального контента через современный веб-интерфейс с использованием архитектуры клиент-сервер и облачной базы данных.

Система должна:

• Обеспечивать многоуровневую систему авторизации с ролевой моделью доступа (слушатель, артист, администратор, дистрибьютор, модератор) на основе Supabase Authentication;

• Предоставлять функционал поиска, фильтрации и воспроизведения музыкальных треков в различных аудиоформатах (MP3, WAV, FLAC, OGG, M4A);

• Позволять пользователям создавать, редактировать и публиковать плейлисты, а также добавлять треки и альбомы в избранное;

• Обеспечивать комплексную аналитику активности пользователей и популярности контента через визуализацию данных (графики прослушиваний, статистика по трекам и альбомам);

• Гарантировать защиту персональных данных посредством Row Level Security (RLS) политик, аудита изменений и безопасного хранения файлов в Supabase Storage;

• Поддерживать контейнеризацию через Docker и автоматизированное резервное копирование базы данных.

Проект направлен на демонстрацию навыков проектирования нормализованных реляционных баз данных, разработки современных веб-приложений с использованием React и TypeScript, интеграции с облачными сервисами (Supabase) и обеспечения безопасности данных на всех уровнях системы.

## 1.2. Задачи разработки

Для достижения цели разработки были определены следующие задачи:

**Анализ предметной области:**

• Изучить функциональные требования к музыкальному порталу с поддержкой ролей артистов, дистрибьюторов и слушателей.

• Определить ключевые сущности и их взаимосвязи: пользователи (users), артисты (artists), альбомы (albums), треки (tracks), плейлисты (playlists), жанры (genres), история прослушиваний (listening_history), избранное (favorites), заявки на артиста (artist_applications) и аудит-лог (audit_log).

**Проектирование базы данных:**

• Разработать схему базы данных с 13+ таблицами, нормализованными до 3НФ, с поддержкой связей 1:1, 1:M и M:M (например, трек-жанр, плейлист-трек, избранное пользователя).

• Реализовать ограничения целостности данных (NOT NULL, UNIQUE, CHECK для валидации длительности, дат выпуска, форматов файлов), внешние ключи с каскадным удалением и ограничения доменов через ENUM типы (app_role, audio_format).

• Создать представления (VIEW) для упрощения аналитики: `track_statistics` (статистика треков с уровнем популярности), `user_statistics` (активность пользователей), `playlist_duration` и `album_duration` (общая длительность коллекций).

• Оптимизировать производительность через индексы на часто используемых полях (поиск по названиям, фильтрация по датам, сортировка по популярности).

**Разработка серверной логики:**

• Реализовать CRUD-операции для всех сущностей через Supabase Client API с поддержкой транзакций и обработкой ошибок.

• Разработать хранимые функции PostgreSQL для бизнес-операций: `toggle_favorite_track/album/playlist` (переключение избранного), `approve_artist_application` и `reject_artist_application` (модерация заявок), `add_track_to_playlist` (добавление треков в плейлисты), `log_listening` (автоматический подсчет прослушиваний).

• Настроить триггеры для автоматического обновления метаданных: `update_updated_at_column` (обновление временных меток), `audit_changes` (журналирование изменений), `handle_new_user` (создание профиля при регистрации), `listening_history_trigger` (обновление счетчиков прослушиваний).

• Обеспечить транзакционную целостность операций через механизмы Supabase и обработку конфликтов при параллельном доступе.

**Обеспечение безопасности:**

• Внедрить ролевую модель доступа (RBAC) с 5 ролями через таблицу `roles` и связь с пользователями, где по умолчанию назначается роль «слушатель».

• Использовать Supabase Authentication для безопасного хранения паролей с автоматическим хэшированием через bcrypt и поддержкой OAuth провайдеров.

• Реализовать Row Level Security (RLS) политики для всех таблиц, обеспечивающие изоляцию данных пользователей и контроль доступа на уровне строк (например, пользователи видят только свои плейлисты, администраторы могут просматривать все данные).

• Настроить систему аудита изменений через таблицу `audit_log` с автоматической записью операций INSERT, UPDATE, DELETE с указанием пользователя, времени и измененных данных.

• Обеспечить защиту от SQL-инъекций через использование параметризованных запросов Supabase и маскирование критичных данных в интерфейсе (например, скрытие паролей, ограничение доступа к аудит-логам).

**Разработка клиентского приложения:**

• Создать веб-интерфейс на React 18 с TypeScript, используя Vite как сборщик, с адаптивным дизайном на основе Tailwind CSS и компонентов Radix UI (поддержка мобильных, планшетных и десктопных устройств).

• Реализовать маршрутизацию через React Router с защищенными маршрутами (ProtectedRoute) для административных разделов и страниц контент-менеджмента.

• Интегрировать Supabase Client для взаимодействия с базой данных и Storage API для загрузки/воспроизведения аудиофайлов и изображений.

• Реализовать управление состоянием через React Context API (PlayerContext для плеера, AppSettingsContext для настроек) и React Query (@tanstack/react-query) для кэширования и синхронизации данных с сервером.

• Добавить пользовательские настройки с сохранением на сервере: тема оформления (светлая/темная через next-themes), язык интерфейса (русский/английский), размер страниц пагинации, формат отображения дат.

• Реализовать горячие клавиши для управления плеером и навигации (Space для воспроизведения/паузы, стрелки для переключения треков, M для отключения звука и др.).

**Аналитика и отчеты:**

• Разработать страницу аналитики с визуализацией данных через библиотеку Recharts: графики прослушиваний по времени, статистика по жанрам, популярные треки и альбомы, активность пользователей.

• Реализовать фильтры по датам, жанрам и артистам с возможностью экспорта данных в CSV через библиотеку jsPDF или нативные методы браузера.

• Интегрировать отображение статистики из представлений базы данных (`track_statistics`, `user_statistics`) с обновлением в реальном времени.

**Тестирование и DevOps:**

• Провести функциональное тестирование всех компонентов интерфейса и интеграционное тестирование взаимодействия с Supabase API.

• Настроить автоматизированное резервное копирование базы данных Supabase через скрипт `backup-supabase.js` (или `backup-supabase-windows.bat` для Windows) с поддержкой сжатия (tar.gz), бэкапа базы данных и Storage файлов, а также загрузки в облачное хранилище (AWS S3, Google Drive через rclone).

• Использовать Git (GitHub) для контроля версий с понятной структурой коммитов и описанием изменений в миграциях базы данных.

• Подготовить контейнеризацию через Docker (многоэтапная сборка для оптимизации размера образа) и Docker Compose для оркестрации сервисов (приложение на Nginx, PostgreSQL, Redis для кэширования, Nginx как reverse proxy).

• Документировать процесс развертывания в файлах README и миграциях с описанием переменных окружения и зависимостей.

**Документирование:**

• Подготовить пояснительную записку с описанием архитектуры системы, ERD-схемой базы данных, описанием API endpoints Supabase и примерами использования.

• Составить руководство пользователя с инструкциями по регистрации, загрузке контента, созданию плейлистов и работе с аналитикой.

• Документировать спецификацию API через комментарии в коде и описание функций базы данных с параметрами и возвращаемыми значениями.

## 1.3. Актуальность разработки

Разработка музыкального онлайн-портала «ImperialTunes» актуальна в условиях роста популярности стриминговых сервисов, таких как Spotify, Apple Music и VK Music, которые обеспечивают доступ к миллионам треков и формируют новые стандарты взаимодействия с музыкальным контентом. По данным аналитиков, мировой рынок музыкального стриминга в 2025 году превысил 30 миллиардов долларов США, что подчеркивает востребованность подобных платформ. Проект позволяет студенту освоить современные технологии разработки веб-приложений, включая:

• Проектирование нормализованных реляционных баз данных с использованием PostgreSQL и облачных решений (Supabase), что соответствует требованиям индустрии к масштабируемости и надежности.

• Разработку клиентских приложений на React с TypeScript, что является стандартом для создания интерактивных пользовательских интерфейсов в современных веб-приложениях.

• Обеспечение безопасности данных через Row Level Security (RLS), аудит изменений и защиту от SQL-инъекций, что критично для приложений, работающих с персональными данными пользователей.

• Интеграцию аналитики и визуализации данных, что востребовано для принятия бизнес-решений на основе пользовательской активности.

Актуальность также определяется необходимостью адаптации интерфейса под разные устройства (responsive design), поддержки темной и светлой темы и многоязычности, что соответствует текущим требованиям UX/UI дизайна. Разработка системы с открытым исходным кодом и контейнеризацией (Docker) способствует формированию навыков DevOps и CI/CD, востребованных в индустрии. Использование облачной платформы Supabase демонстрирует понимание современных подходов к разработке full-stack приложений с минимизацией затрат на инфраструктуру.

## 1.4. Краткое описание предметной области

Предметная область проекта охватывает создание и управление музыкальным контентом в онлайн-среде с поддержкой многопользовательского доступа и ролевой модели. Основные сущности системы включают:

**Пользователи и роли:** Пользователи системы (`users`) с расширением данных из Supabase Authentication, связанные с ролями (`roles`) через внешний ключ. Роли определяют права доступа: слушатели могут прослушивать музыку и создавать плейлисты, артисты могут загружать треки и альбомы, дистрибьюторы управляют заявками на артистов, администраторы и модераторы контролируют контент и пользователей.

**Музыкальный контент:** Треки (`tracks`) с метаданными (название, длительность, URL аудиофайла, счетчики прослушиваний и лайков), связанные с альбомами (`albums`) и артистами (`artists`) через внешние ключи. Альбомы содержат информацию о дате выпуска, обложке и описании. Жанры (`genres`) связаны с треками через таблицу связей `track_genres` (связь M:M).

**Пользовательские коллекции:** Плейлисты (`playlists`) создаются пользователями и содержат треки через таблицу `playlist_tracks` с указанием порядка. Пользователи могут добавлять треки, альбомы и плейлисты в избранное через таблицы `favorites_tracks`, `favorites_albums`, `favorites_playlists`.

**Аналитика и история:** История прослушиваний (`listening_history`) записывается автоматически при воспроизведении треков с указанием длительности прослушивания и флага завершения. Таблица аудита (`audit_log`) фиксирует все изменения в критичных таблицах (треки, плейлисты) с сохранением старых и новых значений в формате JSONB.

**Модерация:** Заявки на получение статуса артиста (`artist_applications`) обрабатываются дистрибьюторами и модераторами через функции `approve_artist_application` и `reject_artist_application`.

Ключевые процессы включают регистрацию пользователей (автоматическое создание профиля через триггер `handle_new_user`), загрузку контента артистами и дистрибьюторами с модерацией, воспроизведение треков слушателями с автоматической записью в историю, создание и публикацию плейлистов, анализ активности через представления базы данных и визуализацию в интерфейсе. Предметная область требует реализации реляционной базы данных с нормализацией до 3НФ, транзакционной целостности операций (например, добавление трека в плейлист должно быть атомарным), защиты данных через RLS политики и обеспечения производительности через индексы и кэширование. Аналоги (Spotify, VK Music) демонстрируют необходимость адаптивного дизайна, персонализированных рекомендаций на основе истории прослушиваний, аналитики популярности контента и резервного копирования, что учтено в архитектуре ImperialTunes.

